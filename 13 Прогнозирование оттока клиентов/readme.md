# Прогнозирование оттока клиентов

### Описание проекта
Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

### Описание услуг
Оператор предоставляет два основных типа услуг: 
1. Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
2. Интернет. Подключение может быть двух типов: через телефонную линию (DSL, от англ. digital subscriber line, «цифровая абонентская линия») или оптоволоконный кабель (Fiber optic).

Также доступны такие услуги:
- Интернет-безопасность: антивирус (DeviceProtection) и блокировка небезопасных сайтов (OnlineSecurity);
- Выделенная линия технической поддержки (TechSupport);
- Облачное хранилище файлов для резервного копирования данных (OnlineBackup);
- Стриминговое телевидение (StreamingTV) и каталог фильмов (StreamingMovies).

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

### Цель проекта
Построить модель для определения оттока клиентов.

### Описание данных
**Данные состоят из файлов, полученных из разных источников:**
- <code>contract_new.csv</code> — информация о договоре;
- <code>personal_new.csv</code> — персональные данные клиента;
- <code>internet_new.csv</code> — информация об интернет-услугах;
- <code>phone_new.csv</code> — информация об услугах телефонии.

**Поля:**
- <code>BeginDate</code> – дата начала пользования услугами.
- <code>EndDate</code> – дата окончания пользования услугами.
- <code>Type</code> – тип оплаты: ежемесячный, годовой и тд.
- <code>PaperlessBilling</code> – безналичный расчет.
- <code>PaymentMethod</code> – способ оплаты.
- <code>MonthlyCharges</code> – ежемесячные траты на услуги.
- <code>TotalCharges</code> – всего потрачено денег на услуги.
- <code>Dependents</code> – наличие иждивенцев.
- <code>Senior Citizen</code> – наличие пенсионного статуса по возрасту.
- <code>Partner</code> – наличие супруга(и).
- <code>MultipleLines</code> – наличие возможности ведения параллельных линий во время звонка.

Во всех файлах столбец customerID содержит код клиента.

Информация о договорах актуальна на 1 февраля 2020.

### План проекта
1. Загрузить и изучить данные;
2. Провести предобработку данных:
    - работа с пропусками,
    - работа с дубликатами,
    - объединение таблиц в одну;
3. Провести исследовательский анализ данных:
    - визуализация признаков,
    - проверить данные на наличие мультиколлинеарности,
    - проверить данные на дисбаланс классов;
4. Подготовить признаки и разбить данные на выборки;  
5. Исследовать модели (будем решать задачу с учителем: в распоряжении обучающий набор данных и целевой признак, который нужно предсказать по остальным признакам),
    - RandomForestClassifier,
    - CatBoost;
    - Анализ;
6. Выбрать лучшую модель и проверить её на тестовой выборке;  
7. Сделать общие выводы.

### Выводы
Всего 7043 клиента оператора связи «Ниединогоразрыва.ком». Стоит отметить, что пользователей интернета - 5517 человек, пользователей стационарной телефонной связи - 6361 человек.  
  
Информация по таблицам:

*Таблица contract:*  
В таблице *contract* 7043 записей, пропусков не обнаружено, дубликатов не обнаружено. 
   - <code>BeginDate</code> – необходимо изменить тип данных на *datetime*,
   - <code>EndDate</code> – необходимо "No" заменить на дату выгрузки (1 февраля 2020),
   - <code>TotalCharges</code> - необходимо изменить тип данных на *float*.  
  
*Таблица personal:*  
В таблице *personal* 7043 записи, пропусков не обнаружено, дубликатов не обнаружено.  

*Таблица internet:*  
В таблице *internet* 5517 записей, пропусков не обнаружено, дубликатов не обнаружено.
  
*Таблица phone:*  
В таблице *phone* 6361 запись, пропусков не обнаружено, дубликатов не обнаружено.

В ходе предобработки данных было выполнено следующее: 
1. Изменены типы данных.  
    - <code>BeginDate</code> – *datetime*,
    - <code>EndDate</code> – "No" заменено на дату выгрузки (1 февраля 2020), тип данных - *datetime*,
    - <code>TotalCharges</code> - *float*.  
2. "Yes" и "No" изменили на 1 и 0 соответственно во всей таблице.
3. В столбцах <code>InternetService</code>, <code>OnlineSecurity</code>, <code>OnlineBackup</code>, <code>DeviceProtection</code>, <code>TechSupport</code>, <code>StreamingTV</code>, <code>StreamingMovies</code>, <code>MultipleLines</code> заполнили пропуски нулевыми значениями.
4. Поля <code>gender</code> и <code>InternetService</code> - поля с двумя уникальными значениями, поэтому название полей изменили на <code>is_male</code> и <code>is_DSL</code>, а значения в полях изменили на 0 и 1.

В ходе исследовательского анализа данных было выявлено следующее:
1. Клиенты с высокими ежемесячными тратами на телефонную связь чаще используют дополнительные услуги, такие как онлайн-защита, резервное копирование, защита устройств, техническая поддержка и стриминговое тв-вещание и каталог фильмов. Они также чаще используют безналичный расчет. В то же время, клиенты с невысокими ежемесячными тратами предпочитают менее дорогие планы и реже используют дополнительные услуги.
2. Был выделен целевой признак - ушёл ли клиент - в новый столбец <code>is_lost_customer</code>, в котором 1 - клиент ушёл, 0 - клиент не ушёл.
3. Изучено наличие мультиколлинеарности с помощью матрицы корреляций и анализа дисперсионных инфляционных факторов. Было выявлено, что <code>TotalCharges</code> и <code>duration</code> имеют проблему мультиколлинеарности с другими переменными в модели. Столбец <code>TotalCharges</code> был удален.
4. Изучен дисбаланс классов: классы являются несбалансированными, поскольку делятся примерно в соотношении 85% и 15%, но бороться с этим не будем, так как будем использовать подходы и метрику, которые устойчивы к дисбалансу классов.

В ходе подготовки признаков и выборок для обучения были выполнены следующие шаги:

1. Удалены признаки <code>BeginDate</code> и <code>EndDate</code>: Было решено удалить признаки <code>BeginDate</code> и <code>EndDate</code>, так как они уже не являются необходимыми для анализа после создания признака <code>duration</code>.

2. Применено прямое кодирование: для категориальных признаков <code>Type</code> и <code>PaymentMethod</code> было применено прямое кодирование с использованием функции pd.get_dummies. Прямое кодирование перевело эти категориальные признаки в фиктивные переменные, что позволяет модели машинного обучения работать с категориальными данными.

3. Данные разделены на признаки: были определены признаки, которые будут использоваться для обучения модели.

4. Данные разделены на выборки: данные были разделены на обучающую выборку и тестовую выборку в отношении 3:1 с помощью функции train_test_split из модуля sklearn.model_selection. Это позволит нам оценить производительность модели на новых данных, которые она не видела во время обучения.

5. Использован StandardScaler: для предварительной обработки числовых признаков был использован StandardScaler из модуля sklearn.preprocessing. StandardScaler масштабирует признаки таким образом, чтобы их среднее значение было 0, а стандартное отклонение - 1. Это позволяет привести числовые признаки к одному масштабу и предотвратить искажение относительной важности признаков.

В результате выполнения этих шагов мы подготовили признаки и выборки для обучения модели машинного обучения. Преобразование категориальных признаков было выполнено с помощью прямого кодирования, числовые признаки были масштабированы, и данные были разделены на обучающую и тестовую выборки. Теперь мы готовы приступить к обучению модели и оценке ее производительности на новых данных.

После обучения моделей было выявлено, что лучшей моделью для данной задачи является CatBoost (со следующими параметрами: {'depth': 4, 'iterations': 500, 'learning_rate': 0.3}), потому что:

1. ROC-AUC: CatBoost демонстрирует наилучший результат по метрике roc_auc_score с значением 0.92. Это означает, что модель CatBoost наиболее точно предсказывает вероятность различных классов.

2. Время обучения и предсказания: CatBoost показывает хорошую производительность в обучении и предсказании. Хотя время обучения RandomForestClassifier меньше, CatBoost все равно имеет более низкое время предсказания.

С учетом лучшего показателя метрики, а также хорошей производительности в обучении и предсказании, модель CatBoost является лучшим выбором для решения данной задачи.

Измерение производительности модели CatBoostClassifierr на тестовой выборке показало следующие результаты:

- Значение roc_auc_score: 0.93

Это означает, что модель CatBoostClassifierr достигла требуемого порогового значения roc_auc_score, равного 0.85, на тестовой выборке. Таким образом, модель показывает хорошую предсказательную способность и может быть использована для решения задачи классификации в рамках данного проекта.
